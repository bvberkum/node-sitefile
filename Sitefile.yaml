#!/usr/bin/env sitefile
#
# Sitefile for node-sitefile document server
# A note of caution: this example config does shameless things like executing any shell
# script if you want to, like call http://localhost/clean.sh. Ymmv. 
#
# Id: node-sitefile/0.0.5-dev+20161010
sitefile: 0.0.5-dev

showStackError: true

paths:
  routers_replace: false
  routers: [
    'sitefile:example/routers'
  ]

routes:

  media/script/sitefile-client.js: static:build/client/sf-v0.js
  media/style: static:build/style
  
  doc/literate: static:build/docs/docco/

  # FIXME: example/: redir:example/main
  example: static:example

  example/bookshelf/knex.sqlite/_/v1: bookshelfapi:example/bookshelf/knex.json
  example/bookshelf/knex: knex:example/bookshelf/knex.json
  # Example, get data from another endpoint, the one above?
  # XXX: example/bookshelf/knex/query-1: knex.sql:example/bookshelf/sql.coffee?knex=..

  _pug: pug:example/**/*.pug
  _stylus: stylus:example/**/*.styl
  _sass: sass:example/**/*.sass
  _coffee: coffee:example/**/*.coffee
  _markdown: markdown:*.md
  _markdown_1: markdown:example/**/*.md
  _sh: sh:example/*.sh
  _gv: gv:example/*.gv
  # FIXME: aliases _pu: pu:example/*.pu
  _plantuml: plantuml:example/*.plantuml

  mocha/client/*: mocha.client:#
  mocha/server/*: mocha.test:#

  # Some defaults for root
  '': redir:ReadMe
  index: redir:ReadMe

  # Example routes for ReadMe
  #ReadMe: du:ReadMe.rst # Du defaults to HTML
  #ReadMe: redir:ReadMe.html
  #ReadMe.html: du:ReadMe.rst
  #ReadMe.xml: du:ReadMe.rst
  
  # Dynamic rules using glob spec
  _du: du:**/*.rst
  #_rst2html: rst2html:**/*.rst
  
  Sitefile: redir:Sitefile.yaml
  Sitefile.yaml: static:Sitefile.yaml
  Sitefile.json: sitefile:?resolve=sitefile
  Sitefile/debug: sitefile:#
  Sitefile/resource: sitefile.resource:#
  Sitefile/handler: sitefile.handler:#
  Sitefile/global: sitefile.global:#

  Sitefile/core/auto: core.autocomplete:#
  Sitefile/core: core:#

  npm/npm/latest.json: 'http:'
  npm/node-sitefile/latest.json: 'http:'
  npm/packages/: 'static:{,sitefile:}node_modules/'

  proc/pm2: pm2:pm2-apps.json

  vendor/:package.:format: http.vendor:cdn.json
  ref/:ref: http.ref:#
  res/:ref: http.res:#
  site/:site/:path: http.site:sites.json

  app/rjs-sf-v0.json: http.requirejs/config:paths=$ref:cdn.json#/js/http/packages;baseUrl=/app/lib;main=cs!sf-v0
  app/rjs-sf-v0.js: http.requirejs/main:app/rjs-sf-v0.json

  # TODO: move app-0 to http
  #app/v0: http.requirejs:view=main.pug;main=app/rjs-sf-v0

  # TODO: deprecated app-0 router
  app/v0: app-0:#
  app/v0/base.css: app-0.cdn_css:build/style/default.css
  #app/v0/base.js: app-0.cdn_js:build/client/sf-v0.js
  app/v0/reader.html: app-0.reader:#
  app/reader: app-0.reader:#

  app: static:lib/sitefile/client

  # FIXME:
  fonts: static:node_modules/bootstrap/fonts

  sf-example/default: sf-example:#
  sf-example/data1: sf-example.data1:#
  sf-example/data2: sf-example.data2:#

  #/shadows/:path: convert.filter:**/*.png

  tools: static:tools


options:
  global:
    du:
      link_stylesheets: true
      scripts:
        $ref: '#/defs/scripts/default'
      stylesheets:
        $ref: '#/defs/stylesheets/default/urls'
    rst2html:
      link_stylesheets: true
      flags:
      - "--no-toc-backlinks"
      scripts:
        $ref: '#/defs/scripts/default'
      stylesheets:
        $ref: '#/defs/stylesheets/default/urls'
    pug:
      scripts:
        $ref: '#/defs/scripts/default'
      stylesheets:
        $ref: '#/defs/stylesheets/default/urls'

  local:
    shadows/: {}
      
    npm/node-sitefile/latest.json:
      spec: 
        hostname: 'registry.npmjs.org'
        path: '/node-sitefile/latest'
    npm/npm/latest.json:
      spec: 
        hostname: 'registry.npmjs.org'
        path: '/npm/latest'
    Sitefile/debug: 
      local_var: 'fooooo'
    app/v0:
      clients:
        $ref: '#/defs/app/base/clients'


defs:
  scripts:
    default:
      urls:
        - /vendor/jquery.js
        - /media/script/sitefile-client.js
      paths:
        - build/client/default.js
  stylesheets:
    default:
      urls:
        - /vendor/bootstrap.css
        - /vendor/bootstrap-theme.css
        - /media/style/default.css
      paths:
        - build/style/default.css

  app:
    base:
      clients:
        - type: require-js
          id: require-js-sitefile-v0-app
          href: /vendor/require.js
          main: /app/rjs-sf-v0.js


